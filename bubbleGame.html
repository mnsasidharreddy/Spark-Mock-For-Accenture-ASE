<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Numerical Ability Assessment</title>
    <style>
        :root {
            --bg: #7a7a7a;
            --panel: #e6e6e6;
            --dark: #000000;
            --accent: #58a6ff;
            --border: #b0b0b0;
        }

        body, html {
            margin: 0; padding: 0; height: 100%;
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        header {
            background: var(--dark);
            color: white;
            padding: 0 30px;
            height: 60px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            z-index: 2000; 
        }

        .spark-logo { font-weight: 800; font-size: 24px; letter-spacing: 1px; }
        .spark-logo span { color: var(--accent); font-size: 30px; line-height: 0; }

        #navbar-sub {
            background: #444;
            color: #ddd;
            padding: 8px 30px;
            font-size: 14px;
            display: none;
            border-bottom: 1px solid #555;
            z-index: 1500;
        }

        .content-area {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            background-color: var(--panel);
            align-items: center;
            position: relative;
        }

        .instruction-box {
            background-color: #ffffff;
            padding: 25px 35px;
            margin-top: 50px;
            border: 1px solid #c0c0c0;
            line-height: 1.6;
            color: #333;
            max-width: 700px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .action-nav-bar {
            margin-top: auto; 
            background-color: #d9d9d9;
            height: 75px;
            width: 100%;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 40px;
            box-sizing: border-box;
        }
        footer {
            background-color: var(--dark);
            color: #fff;
            height: 50px;
            width: 100%;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0 30px;
            box-sizing: border-box;
            flex-shrink: 0;
            font-size: 20px;
            z-index: 2000;
        }

        .heart { color: #ff0000; margin: 0 4px; }

        #quiz-overlay {
            display: none;
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #e8e8e8;
            padding: 50px 60px;
            width: 85%;
            max-width: 850px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            border-radius: 2px;
        }

        #game-screen { display: none; height: 100%; width: 100%; background: white; flex-direction: column; align-items: center; justify-content: center; }
        #bubbleBox { width: 520px; height: 520px; background: #e0e0e0; border-radius: 10px; position: relative; }
        .bubble { position: absolute; width: 180px; height: 180px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); user-select: none; }
        .bubble.selected { background: #cccccc; }

        .next-btn, .start-test-btn { background-color: #333; color: white; padding: 12px 30px; border: none; cursor: pointer; text-transform: uppercase; font-weight: bold; font-size: 14px; border-radius: 2px; }
        .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); font-size: 45px; color: #555; cursor: pointer; user-select: none; }
        .arrow-left { left: 20px; }
        .arrow-right { right: 20px; }
        .pagination-dots { display: flex; justify-content: center; margin-top: 30px; gap: 12px; }
        .dot { height: 10px; width: 10px; border: 1px solid #666; border-radius: 50%; }
        .dot.active { background-color: #333; border-color: #333; }

        #timerStroke { fill: none; stroke: black; stroke-width: 4; stroke-dasharray: 226.2; transition: stroke-dashoffset 1s linear; }
        .navbar {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        color: #fff;
        font-size: 16px; 
        text-align: center;
        font-weight: bold;
        width: auto;
        white-space: nowrap;
    }
    </style>
</head>
<body>

    <header>
        <div class="spark-logo">SPARK<span>.</span></div>
        <div class="navbar" style="color:white">
    Please note: Your video and audio is being recorded.It will be reviewed to check for integrity.
    </div>
    </header>

    <div id="navbar-sub">
        <span>Question</span> <span id="questionNum">1</span> <span>of 28</span>
    </div>

    <div class="content-area">
        <div id="ui-view" style="display: flex; flex-direction: column; width: 100%; height: 100%; align-items: center;">
            <div class="instruction-box" id="main-content">
                <p>This practice exercise will provide you with instructions and practice items for a task designed to measure <strong>numerical ability</strong>.</p>
                <p>Please take the time to read the instructions carefully and use the practice items to familiarize yourself with the task.</p>
            </div>
            
            <div class="action-nav-bar">
                <button class="next-btn" id="ui-action-btn" onclick="startQuizFlow()">Next</button>
            </div>
        </div>

        <div id="quiz-overlay">
            <div class="modal-content">
                <div class="nav-arrow arrow-left" id="prevArrow" onclick="prevStep()">&#10094;</div>
                <div class="modal-text" id="modalText" style="font-size: 20px; color: #333; line-height: 1.5; text-align: center; padding: 0 40px;"></div>
                <button id="startTestBtn" class="start-test-btn" style="display: none; align-self: center; margin-top: 20px;" onclick="initiateGame()">START TEST</button>
                <div class="nav-arrow arrow-right" id="nextArrow" onclick="nextStep()">&#10095;</div>
                <div class="pagination-dots">
                    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                    <div class="dot"></div><div class="dot"></div>
                </div>
            </div>
        </div>

        <div id="game-screen">
            <div id="bubbleBox">
                <div class="bubble" id="bubble1" style="top: 30px; left: 30px;"></div>
                <div class="bubble" id="bubble2" style="top: 170px; right: 30px;"></div>
                <div class="bubble" id="bubble3" style="bottom: 30px; left: 30px;"></div>
            </div>
            <div style="display: flex; align-items: center; gap: 30px; margin-top: 20px;">
                <div style="position: relative; width: 80px; height: 80px;">
                    <svg width="80" height="80" style="transform: rotate(-90deg);"><circle id="timerStroke" cx="40" cy="40" r="36"></circle></svg>
                    <div id="timerText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold;">15</div>
                </div>
                <div style="font-size: 16px;">
                    Select the bubbles in order from the <br><strong>LOWEST</strong> to the <strong>HIGHEST</strong> value
                </div>
            </div>
        </div>
    </div>

    <footer style="font-size: 20px;">
        <div>with <span class="heart">‚ù§</span> SASIDHAR</div>
    </footer>

    <script>
        let currentStep = 1;
        let finalScore = 0;
        const instructionContent = {
            1: "Three bubbles will appear on screen, each containing a number or numeric expression. Your task is to select each bubble in order from the <strong>LOWEST</strong> to the <strong>HIGHEST</strong> value.",
            2: "You can select a bubble by clicking on it.",
            3: "You can deselect a bubble by clicking on it again. However, you will automatically advance to the next question after the third bubble is selected.",
            4: "Each set of bubbles has a time limit, indicated by the timer at the bottom of the screen.",
            5: "Press the <strong>START TEST</strong> button to proceed."
        };

        function startQuizFlow() {
            document.getElementById('ui-view').style.display = 'none';
            document.getElementById('quiz-overlay').style.display = 'flex';
            updateModal();
        }

        function nextStep() { if (currentStep < 5) { currentStep++; updateModal(); } }
        function prevStep() { if (currentStep > 1) { currentStep--; updateModal(); } }

        function updateModal() {
            const textField = document.getElementById('modalText');
            const dots = document.querySelectorAll('#quiz-overlay .dot');
            textField.innerHTML = instructionContent[currentStep];
            dots.forEach((dot, index) => dot.classList.toggle('active', index === currentStep - 1));
            document.getElementById('prevArrow').style.display = (currentStep === 1) ? 'none' : 'block';
            document.getElementById('nextArrow').style.display = (currentStep === 5) ? 'none' : 'block';
            document.getElementById('startTestBtn').style.display = (currentStep === 5) ? 'block' : 'none';
        }

        let question = 1;
        let selectedOrder = [];
        let correctOrder = [];
        let timerInterval;

        function initiateGame() {
            document.getElementById('quiz-overlay').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            document.getElementById('navbar-sub').style.display = 'block';
            loadQuestion();
        }

        function generateArithmetic() {
    let a = Math.floor(Math.random() * 50) + 1;
    let b = Math.floor(Math.random() * 20) + 1;
    let op = ['+', '-', '*', '/'][Math.floor(Math.random() * 4)];
    let res;

    if (op === '+') res = a + b;
    else if (op === '-') {
        if (a < b) [a, b] = [b, a];
        res = a - b;
    } 
    else if (op === '*') res = a * b;
    else if (op === '/') {
        res = parseFloat((a / b).toFixed(2));
    }

    return { eq: `${a} ${op} ${b}`, val: res };
}

        function loadQuestion() {
            selectedOrder = [];
            let eqs = [];
            while (eqs.length < 3) {
                let candidate = generateArithmetic();
                if (!eqs.find(e => e.val === candidate.val)) eqs.push(candidate);
            }
            correctOrder = [...eqs].sort((a, b) => a.val - b.val).map(e => e.eq);
            
            const bubbles = document.querySelectorAll('.bubble');
            bubbles.forEach((b, i) => {
                b.innerText = eqs[i].eq;
                b.classList.remove('selected');
                b.onclick = () => {
                    if (selectedOrder.includes(b)) {
                        b.classList.remove('selected');
                        selectedOrder = selectedOrder.filter(item => item !== b);
                    } else if (selectedOrder.length < 3) {
                        b.classList.add('selected');
                        selectedOrder.push(b);
                        if (selectedOrder.length === 3) {
                            clearInterval(timerInterval);
                            if (JSON.stringify(selectedOrder.map(x => x.innerText)) === JSON.stringify(correctOrder)) finalScore++;
                            setTimeout(nextQuestion, 400);
                        }
                    }
                };
            });
            document.getElementById("questionNum").innerText = question;
            startTimer();
        }

        function startTimer() {
            let time = 15;
            const text = document.getElementById("timerText");
            const stroke = document.getElementById("timerStroke");
            text.innerText = time;
            stroke.style.strokeDashoffset = 0;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                time--;
                text.innerText = time;
                stroke.style.strokeDashoffset = (15 - time) * (226.2 / 15);
                if (time <= 0) { clearInterval(timerInterval); nextQuestion(); }
            }, 1000);
        }

        function nextQuestion() {
            if (question >= 28) { finishAssessment(); return; }
            question++;
            loadQuestion();
        }

        function finishAssessment() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('navbar-sub').style.display = 'none';
            document.getElementById('ui-view').style.display = 'flex';
            //document.getElementById('main-content').innerHTML = `
               // <p>This practice exercise will provide you with instructions and practice items for a task designed to measure <strong>image rotation ability</strong>.</p>
               // <p>Please take the time to read the instructions carefully and use the practice items to familiarize yourself with the task.</p>`;
        localStorage.setItem("bubble_test_score", finalScore);
        window.location.href = './bpathfinder.html';
        }
    </script>
</body>
</html>